---

- name: Install prerequisites packages
  apt:
    pkg: "{{ item }}"
    state: present
    update_cache: yes
    cache_valid_time: 3600
  with_items:
    - openjdk-8-jdk

- name: Add Mesosphere key on remote server
  apt_key:
    id: E56151BF
    keyserver: keyserver.ubuntu.com
    state: present

- name: Add Mesosphere repository on remote server
  apt_repository:
    repo: deb {{ marathon_apt_url }} {{ ansible_distribution_release | lower }} main
    state: present
    update_cache: yes

- name: Install Marathon on remote server
  apt:
    name: marathon
    update_cache: yes
    state: present

- name: Create Marathon directory
  file:
    state: directory
    path: /etc/marathon/conf
    mode: 0755
    owner: root
    group: root

- name: Configure Marathon on remote system
  template:
    src: "{{ item }}.j2"
    dest: "/{{ item }}"
    owner: root
    group: root
    mode: 0664
  with_items:
    - "etc/default/marathon"
  notify:
    - Restart marathon
  tags: config
#
# - name: Configure Marathon systemd service
#   template:
#     src: "{{ item }}.j2"
#     dest: "/{{ item }}"
#     owner: root
#     group: root
#     mode: 0664
#   with_items:
#     - "lib/systemd/system/mesos-master.service"
#   when: inventory_hostname in groups['master']
#   notify:
#     - Restart marathon
